@model IEnumerable<APP.Models.PhauThuatThuThuat>

<div class="container mt-5 text-center">
    <h3 class="fw-bold text-danger mb-4">
        <i class="bi bi-scissors"></i>🔍  DANH SÁCH PHẪU THUẬT / THỦ THUẬT
    </h3>

    @* Success alert removed; using centered toast instead *@
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show text-start" role="alert">
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <form method="get" asp-action="Index" class="d-flex justify-content-center mb-4 align-items-center" id="searchForm">
        <input type="text" name="search" value="@ViewBag.Search"
               class="form-control me-2 search-box"
               placeholder="Nhập mã KCB hoặc mã phẫu thuật..." />
        <button type="submit" class="btn btn-danger me-2">
            🔍 Tìm kiếm
        </button>
        <button type="button" class="btn btn-outline-light"
                onclick="deleteSelected()">
            🗑️ Xóa các dòng đã chọn
        </button>
    </form>

    <form id="deleteForm" method="post" asp-action="DeleteSelected">
        <table class="table table-bordered table-hover compact-table shadow-sm text-center align-middle">
            <thead class="table-header-red text-white">
                <tr>
                    <th style="white-space: nowrap;">Mã KCB</th>
                    <th style="white-space: nowrap;">Họ và tên</th>
                    <th style="white-space: nowrap;">Mã phẫu thuật</th>
                    <th style="white-space: nowrap;">Khoa</th>
                    <th style="white-space: nowrap;">Phòng</th>
                    <th style="white-space: nowrap;">Mã thanh toán</th>
                     <th style="white-space: nowrap;">Bác sĩ</th>
                    <th style="white-space: nowrap;">Ngày bắt đầu</th>
                    <th style="white-space: nowrap;">Ngày kết thúc</th>
                    <th style="white-space: nowrap;">Chẩn đoán trước mổ</th>
                     <th style="white-space: nowrap;">Chẩn đoán sau mổ</th>
                      <th style="white-space: nowrap;">Diễn biến</th>
                    <th style="white-space: nowrap;">Đã ký</th>
                    <th style="white-space: nowrap;">Sửa</th>
                    <th style="width: 40px;">✔</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.makcb</td>
                            <td class="text-nowrap">@item.hoten</td>
                            <td>@item.maphauthuat</td>
                            <td class="text-nowrap">@item.tenkk</td>
                            <td class="text-nowrap">@item.tenphong</td>
                            <td>@item.mathanhtoan</td>
                            <td>@item.ailam</td>
                            <td class="text-nowrap">@(item.ngaybatdaumo?.ToString("dd/MM/yyyy HH:mm") ?? "-")</td>
                            <td>@(item.ngayketthucmo?.ToString("dd/MM/yyyy HH:mm") ?? "-")</td>
                            <td class="text-start">@item.chandoantruocmo</td>
                            <td class="text-start">@item.chandoansaumo</td>
                            <td class="text-start">@item.dienbien</td>                  
                            <td>
                                @if (!string.IsNullOrEmpty(item.daky))
                                {
                                    <span class="badge bg-success">Đã ký</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Chưa ký</span>
                                }
                            </td>
                            <td>
                                <a asp-action="Edit"
                                   asp-route-makcb="@item.makcb"
                                   asp-route-maphauthuat="@item.maphauthuat"
                                   class="btn edit-btn"
                                   title="Chỉnh sửa"
                                   form="none">
                                    ✏️ <span>Sửa</span>
                                </a>



                            </td>


                            <td>
                                <input type="checkbox" name="selectedIds" value="@item.maphauthuat" />
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr><td colspan="12" class="text-muted text-center">Không có dữ liệu</td></tr>
                }
            </tbody>
        </table>
    </form>
</div>

@if (TempData["Success"] != null)
{
    <div id="successToast" class="center-toast">
        @TempData["Success"]
    </div>
    <script>
        setTimeout(function () {
            var toast = document.getElementById('successToast');
            if (toast) {
                toast.style.transition = 'opacity 300ms ease';
                toast.style.opacity = '0';
                setTimeout(function () { toast.remove(); }, 350);
            }
        }, 3500);
    </script>
}

<script>function deleteSelected() {
        const selected = document.querySelectorAll('input[name="selectedIds"]:checked');
        if (selected.length === 0) {
            alert("⚠️ Vui lòng chọn ít nhất một dòng để xóa!");
            return;
        }

        if (confirm("Bạn có chắc chắn muốn xóa các dòng đã chọn không?")) {
            document.getElementById('deleteForm').submit();
        }
    }</script>

<style>
    body {
        background-color: #fff5f7;
        font-family: 'Segoe UI', sans-serif;
    }

    .table-header-red {
        background-color: #e91e63 !important;
        font-weight: bold;
        text-transform: uppercase;
    }

    .table th, .table td {
        font-size: 13px;
        border: 1px solid #f3b8c5;
    }

    .table-hover tbody tr:hover {
        background-color: #fff0f3 !important;
    }

    .search-box {
        max-width: 260px;
        border: 1px solid #e91e63;
        border-radius: 6px;
        height: 34px;
    }

    .edit-btn {
        display: inline-flex; /* Icon + chữ cùng hàng */
        align-items: center; /* Căn giữa theo trục dọc */
        justify-content: center;
        gap: 6px; /* Khoảng cách giữa icon và chữ */
        padding: 4px 12px; /* Chiều cao + rộng nút */
        font-size: 13px;
        font-weight: 600;
        line-height: 1; /* Giúp icon không lệch baseline */
        background-color: #e91e63 !important;
        border: none;
        color: #fff !important;
        border-radius: 6px;
        transition: all 0.2s ease-in-out;
    }

        .edit-btn:hover {
            background-color: #d81b60 !important;
            transform: scale(1.05);
        }



    .btn-danger {
        background-color: #e91e63 !important;
        border: none;
        color: #fff !important;
        font-weight: 500;
    }

    .btn-outline-light {
        background-color: #fff !important;
        border: 1px solid #e91e63 !important;
        color: #e91e63 !important;
        font-weight: 600;
    }

        .btn-outline-light:hover {
            background-color: #e91e63 !important;
            color: #fff !important;
        }

    .center-toast {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1080;
        min-width: 280px;
        max-width: 80vw;
        background: rgba(33, 37, 41, 0.95);
        color: #fff;
        padding: 14px 18px;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        text-align: center;
        font-weight: 600;
    }
</style>