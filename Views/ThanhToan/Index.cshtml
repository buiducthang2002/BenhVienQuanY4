@model List<APP.Models.ThanhToanViewModel>
@{
    ViewData["Title"] = "Tra c·ª©u thanh to√°n";
}

<div class="container-fluid mt-4">
    <div class="card shadow">
        <div class="card-header text-white" style="background-color:#e91e63;">
            <h4 class="mb-0">
                <i class="bi bi-receipt"></i> TRA C·ª®U THANH TO√ÅN THEO S·ªê PHI·∫æU
            </h4>
        </div>

        <div class="card-body">
            <!-- Form t√¨m ki·∫øm -->
            <form asp-controller="ThanhToan" asp-action="Search" method="post" class="mb-4">
                <div class="row g-3 align-items-end">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">S·ªë phi·∫øu thanh to√°n:</label>
                        <input type="text"
                               name="sophieu"
                               class="form-control form-control-lg"
                               placeholder="Nh·∫≠p s·ªë phi·∫øu..."
                               value="@ViewBag.SoPhieuTimKiem"
                               required
                               autofocus />
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i class="bi bi-search"></i> T√¨m ki·∫øm
                        </button>
                    </div>
                    <div class="col-md-3">
                        <a asp-action="Index" class="btn btn-secondary btn-lg w-100">
                            <i class="bi bi-arrow-clockwise"></i> L√†m m·ªõi
                        </a>
                    </div>
                </div>
            </form>

            <!-- Th√¥ng b√°o -->
            @if (ViewBag.Message != null)
            {
                <div class="alert alert-@(ViewBag.MessageType ?? "info") alert-dismissible fade show" role="alert">
                    @Html.Raw(ViewBag.Message)
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <!-- Th√¥ng tin t·ªïng h·ª£p (n·∫øu c√≥ k·∫øt qu·∫£) -->
            @if (Model != null && Model.Count > 0)
            {
                var firstItem = Model.First();
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="alert alert-info mb-3">
                            <h5 class="mb-2">üìã Th√¥ng tin phi·∫øu</h5>
                            <table class="table table-sm table-borderless mb-0">
                                <tr>
                                    <td style="width: 200px;"><strong>S·ªë phi·∫øu:</strong></td>
                                    <td>@firstItem.sophieu</td>
                                    <td style="width: 200px;"><strong>M√£ KCB:</strong></td>
                                    <td>@firstItem.makcb</td>
                                </tr>
                                <tr>
                                    <td><strong>Ng√†y thanh to√°n:</strong></td>
                                    <td>@(firstItem.ngay?.ToString("dd/MM/yyyy HH:mm"))</td>
                                    <td><strong>M√£ thanh to√°n:</strong></td>
                                    <td>@firstItem.mathanhtoan</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- B·∫£ng chi ti·∫øt -->
                <div class="table-responsive">
                    <table class="table table-striped table-hover table-bordered">
                        <thead class="table-dark">
                            <tr class="text-center">
                                <th>STT</th>
                                <th>M√£ thanh to√°n chi ti·∫øt</th>
                                <th>S·ªë phi·∫øu</th>
                                <th>M√£ KCB</th>
                                <th>Ng√†y</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.Count; i++)
                            {
                                <tr>
                                    <td class="text-center">@(i + 1)</td>
                                    <td class="text-center">@Model[i].mathanhtoanct</td>
                                    <td>@Model[i].sophieu</td>
                                    <td>@Model[i].makcb</td>
                                    <td class="text-center">@Model[i].ngay?.ToString("dd/MM/yyyy")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-success mt-3">
                    <strong>‚úÖ T·ªïng s·ªë b·∫£n ghi:</strong> @Model.Count
                </div>
            }
            else if (ViewBag.Message == null)
            {
                <div class="text-center text-muted py-5">
                    <i class="bi bi-search" style="font-size: 4rem;"></i>
                    <p class="mt-3">Nh·∫≠p s·ªë phi·∫øu ƒë·ªÉ tra c·ª©u th√¥ng tin thanh to√°n</p>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto dismiss alerts after 5 seconds
        setTimeout(function() {
            var alerts = document.querySelectorAll('.alert-dismissible');
            alerts.forEach(function(alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>
}
